<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="IslandPostPOS.Views.SalesHistoryPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:IslandPostPOS.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:dtos ="using:IslandPostPOS.Shared.DTOs"
    xmlns:controls="using:Microsoft.UI.Xaml.Controls"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <!--Header-->
        <TextBlock Text="Sales History" Margin="10,20,0,20" FontWeight="Bold" FontSize="25"/>
        <!--Info and Import,Export Buttons-->
        <Grid  Grid.Row="1"  Background="LightGray" Height="100" ColumnSpacing="5" Padding="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Text="Add, view and edit products in one place" FontWeight="SemiLight" VerticalAlignment="Center" Margin="20,0,0,0"/>
            <Button Grid.Column="1" Content="Import" Style="{StaticResource PayButtonStyle}" />
            <Button Grid.Column="2" Content="Add Product" Style="{StaticResource PayButtonStyle}"/>
        </Grid>
        <ScrollViewer Grid.Row="2" Padding="20">
            <Grid Padding="20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <!--FIlters-->
                <Grid Grid.Row="0" Padding="20" ColumnSpacing="5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>                    
                    </Grid.ColumnDefinitions>
                    <StackPanel Orientation="Vertical">
                        <TextBlock Text="Search for Sale Number" FontWeight="Bold" Margin="5"/>
                        <TextBox PlaceholderText="Enter Sale Number" x:Name="searchBar"/>
                    </StackPanel>
                    <StackPanel Orientation="Vertical" Grid.Column="1">
                        <TextBlock Text="Product Category" FontWeight="Bold" Margin="5"/>
                        <CalendarDatePicker PlaceholderText="Pick a date" HorizontalAlignment="Stretch" Date="{x:Bind ViewModel.StartDate,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                    <StackPanel Orientation="Vertical" Grid.Column="2">
                        <TextBlock Text="End Date" FontWeight="Bold" Margin="5"/>
                        <CalendarDatePicker PlaceholderText="Pick a date" HorizontalAlignment="Stretch" Date="{x:Bind ViewModel.EndDate,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                    <Button Command="{x:Bind ViewModel.SearchCommand}" Content="Search" Grid.Column="3" HorizontalAlignment="Right" Width="150" Style="{StaticResource PayButtonStyle}" Margin="0,20,0,0"/>
                </Grid>

                <!--History-->
                <Grid Padding="20" Grid.Row="1">
                    <ListView ItemsSource="{x:Bind ViewModel.Service.SalesHistory,Mode=OneWay}" HorizontalAlignment="Stretch">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="dtos:SaleDTO">
                                <controls:Expander  HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch" >
                                    <controls:Expander.Header>
                                        <Grid ColumnSpacing="12">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Date -->
                                            <TextBlock Text="{x:Bind RegistrationDate, Mode=OneWay}" Grid.Column="0" VerticalAlignment="Center"/>

                                            <!-- Customer -->
                                            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="5" VerticalAlignment="Center">
                                                <PersonPicture DisplayName="{x:Bind ClientName}" Height="30" Width="30"/>
                                                <TextBlock Text="{x:Bind ClientName, Mode=OneWay}" VerticalAlignment="Center"/>
                                            </StackPanel>

                                            <!-- Employee -->
                                            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="5" VerticalAlignment="Center">
                                                <PersonPicture DisplayName="{x:Bind Users}" Height="30" Width="30"/>
                                                <TextBlock Text="{x:Bind Users, Mode=OneWay}" VerticalAlignment="Center"/>
                                            </StackPanel>
                                            <!-- Sale Amount -->
                                            <TextBlock Text="{x:Bind Total, Mode=OneWay}" FontWeight="SemiBold" Grid.Column="3" VerticalAlignment="Center"/>

                                            <TextBlock Text="{x:Bind SaleNumber, Mode=OneWay}" Grid.Column="4" VerticalAlignment="Center"/>

                                            <!-- Status -->
                                            <!--<TextBlock Text="{x:Bind Status, Mode=OneWay}" Grid.Column="4" Foreground="{x:Bind StatusColor}" />-->
                                        </Grid>
                                    </controls:Expander.Header>
                                    <Grid Padding="10">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="300"/>
                                        </Grid.ColumnDefinitions>
                                        <ItemsControl ItemsSource="{x:Bind DetailSales}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate x:DataType="dtos:DetailSaleDTO">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Text="{x:Bind  DescriptionProduct}" />
                                                        <TextBlock Grid.Column="1" Text="{x:Bind Quantity}" />
                                                        <TextBlock Grid.Column="2" Text="{x:Bind Price, Mode=OneWay}" />
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                        <Rectangle Grid.Row="1" Height="1" Fill="Gray" Margin="0,5"/>
                                        <Grid Grid.Row="2" Height="200">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <!--Notes-->
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="*"/>
                                                </Grid.RowDefinitions>
                                                <TextBlock Text="Note:" FontWeight="Bold" Margin="5"/>
                                                <TextBlock
                                                    Grid.Row="1"
                                                    VerticalAlignment="Stretch"
                                                    HorizontalAlignment="Stretch"
                                                    TextWrapping="WrapWholeWords"
                                                    Text="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer viverra erat est, a ullamcorper urna dapibus ac. Suspendisse pulvinar posuere aliquet. Ut ac orci laoreet, ultricies elit sed, condimentum enim. Ut velit leo, lacinia vulputate ex vel, ornare porttitor mi. Sed id mi quis velit ullamcorper mollis. Sed nec urna sed arcu malesuada euismod. Nullam in elementum mauris. Duis sit amet ullamcorper ipsum. Aenean in odio fermentum, mollis dui placerat, mollis mi. Sed lectus orci, interdum aliquam."/>
                                            </Grid>

                                            <!--Sale Grid-->
                                            <Grid Grid.Column="1" RowSpacing="10">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>
                                                <!--  Subtotal and tax -->
                                                <Grid Grid.Row="0">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Text="Subtotal" FontWeight="Bold"/>
                                                    <TextBlock Text="{x:Bind FormatAmount(Subtotal), Mode=OneWay}" FontWeight="Bold" Grid.Column="1"/>
                                                    <TextBlock Text="Tax:" FontWeight="Bold" Grid.Row="1"/>
                                                    <TextBlock Text="{x:Bind FormatAmount(TotalTaxes), Mode=OneWay}" FontWeight="Bold" Grid.Row="1" Grid.Column="1"/>
                                                </Grid>

                                                <!--Seperator-->
                                                <Rectangle Margin="10,0" Grid.Row="4" Height="1" Fill="{ThemeResource SystemControlBackgroundBaseLowBrush}" HorizontalAlignment="Stretch" />

                                                <!--  Total -->
                                                <Grid Grid.Row="5">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <StackPanel Orientation="Horizontal" Spacing="5">
                                                        <TextBlock Text="Sale Total" FontWeight="Bold"/>
                                                        <!--<TextBlock Text="{x:Bind SaleCountTxt, Mode=OneWay}" FontSize="12" VerticalAlignment="Bottom" Foreground="{ThemeResource AccentAAFillColorDefaultBrush}"/>-->
                                                    </StackPanel>
                                                    <TextBlock Text="{x:Bind FormatAmount(Total), Mode=OneWay}" FontWeight="Bold" Grid.Column="1"/>
                                                </Grid>

                                                <!--Seperator-->
                                                <Rectangle Margin="10,0" Grid.Row="6" Height="1" Fill="{ThemeResource SystemControlBackgroundBaseLowBrush}" HorizontalAlignment="Stretch" />

                                                <!--Items-->
                                                <!--
                                                <ScrollViewer Grid.Row="7"
                                                          Margin="0,10"
                                                          VerticalScrollBarVisibility="Auto"
                                                          HorizontalScrollBarVisibility="Disabled">
                                                    <ItemsRepeater ItemsSource="{x:Bind ViewModel.Transactions,Mode=OneWay}" HorizontalAlignment="Stretch">
                                                        <ItemsRepeater.Layout>
                                                            <StackLayout Orientation="Vertical" />
                                                        </ItemsRepeater.Layout>
                                                        <ItemsRepeater.ItemTemplate>
                                                            -->
                                                <!-- Each item is a Transaction Item -->
                                                <!--
                                                            <DataTemplate x:DataType="dto:TransactionDTO">
                                                                <Grid Margin="0,0,0,10">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <Grid.RowDefinitions>
                                                                        <RowDefinition Height="Auto"/>
                                                                        <RowDefinition Height="Auto"/>
                                                                    </Grid.RowDefinitions>

                                                                    <TextBlock Text="{x:Bind PaymentMethodName}" FontWeight="SemiBold"/>
                                                                    <TextBlock Text="{x:Bind Amount}" Grid.Column="1" FontWeight="Bold"/>
                                                                    <TextBlock Text="{x:Bind RegisteredDate, Converter={StaticResource DateTimeToStringConverter}}" Grid.Row="1" Grid.Column="0" FontSize="12"/>
                                                                    -->
                                                <!--Seperator-->
                                                <!--
                                                                    <Rectangle Visibility="Collapsed" Margin="10,10" Grid.Row="3" Grid.ColumnSpan="3" Height="1" Fill="{ThemeResource SystemControlBackgroundBaseLowBrush}" HorizontalAlignment="Stretch" />
                                                                </Grid>
                                                            </DataTemplate>
                                                        </ItemsRepeater.ItemTemplate>
                                                    </ItemsRepeater>
                                                </ScrollViewer>

                                                -->
                                                <!--  Total -->
                                                <!--
                                                <Grid Grid.Row="8" Visibility="{x:Bind ViewModel.GiveChange,Converter={StaticResource BoolToVisibilityConverter},Mode=OneWay}">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Text="Change"/>
                                                    <TextBlock Text="{x:Bind FormatAmount(ViewModel.ChangeAmount), Mode=OneWay}" FontWeight="Bold" Grid.Column="1"/>
                                                </Grid>-->
                                            </Grid>
                                        </Grid>
                                        <Grid Grid.Column="2"  Grid.Row="2" HorizontalAlignment="Right" Padding="0,0,30,0">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="*"/>
                                            </Grid.RowDefinitions>
                                            <!-- Pen (Edit) -->
                                            <Button Style="{StaticResource FlatIconButtonStyle}" Tag="&#xE104;">
                                                Edit
                                            </Button>

                                            <!-- Envelope (Mail) -->
                                            <Button Grid.Row="1" Style="{StaticResource FlatIconButtonStyle}" Tag="&#xE119;">
                                                Email Receipt
                                            </Button>

                                            <!-- Document (Page) -->
                                            <Button Grid.Row="2" Style="{StaticResource FlatIconButtonStyle}" Tag="&#xE130;">
                                                Print Receipt
                                            </Button>

                                            <!-- Cancel (Close/X) -->
                                            <Button Grid.Row="3" Style="{StaticResource FlatIconButtonStyle}" Tag="&#xE10A;">
                                                Void
                                            </Button>

                                        </Grid>
                                    </Grid>
                                </controls:Expander>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
            </Grid>
        </ScrollViewer>
    </Grid>
</Page>
